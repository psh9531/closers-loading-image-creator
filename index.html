<!DOCTYPE html>

<html lang="ko">
<head>

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KCJ6Q95');</script>
<!-- End Google Tag Manager -->

<!-- 구글 애널리틱스 시작(웹페이지 접속자 통계 횟수통계) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-156922276-1"></script>
<script>
    first_Loop();
</script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-156922276-1');
</script>
<!-- 구글 애널리틱스 끝 -->

<meta charset="utf-8">
<title>클로저스 로딩 일러스트 생성기</title>
<!-- css 초기화 -->
<link rel="stylesheet" href="./css/reset.css"/>
<!-- index.html stylesheet -->
<link rel="stylesheet" href="./css/index.css"/>
<!-- character_costumes -->
<script src="./javascript/character_costumes.js"></script>
<!-- frame_options -->
<script src="./javascript/frame_options.js"></script>

<link rel="stylesheet" type="text/css" href="./css/select_css.css">
</head>

<body>

  <div class="nav">
      <dl class="mainTitle">클로저스 로딩 일러 생성기</dl>
      <div class="subTitle_Area">
        <span class="explanation">클로저스 로딩 일러 생성기를 통해, 나만의 로딩 일러스트를 만들어 보세요!</span>
        <span class="subTitle">beta 1.0.0</span>
      </div>
      <!-- <table>
        <tr>
            <td class="explanation">
                
            </td>
            <td class="subTitle">
                <strong>beta 1.0.0</strong>
            </td>
        </tr>
    </table> -->
</div>

<div class="content_Area">
    <div class="null_Area"> </div>

    <div class="information_Area">
        <div class="canvas_Area"> <canvas id="canvas" width="512" height="173"> </canvas> </div>
        <div class="character_Area">
            <table>
                <tr>
                    <td> 
                        <strong> Character </strong> 
                    </td>
                    <td class="character_Area_Detail">
                        <div class="custom-select-wrapper">
                            <div class="custom-select">
                                <div class="custom-select__trigger"><span>캐릭터를 선택하세요</span>
                                    <div class="arrow"></div>
                                </div>
                                <div class="custom-options">
                                    <span class="custom-option selected" data-value="STRIKER">이세하</span>
                                    <span class="custom-option" data-value="CASTER">이슬비</span>
                                    <span class="custom-option" data-value="RANGER">서유리</span>
                                </div>
                            </div>
                        </div>
                        <script type="text/javascript" src="./javascript/select_js.js"></script>
                        <!-- <select name="character_class" onChange="categoryChange(this)"> 
                            <option value="NONE">캐릭터를 선택하세요</option>
                            <option value="STRIKER">이세하</option> 
                            <option value="CASTER">이슬비</option> 
                            <option value="RANGER">서유리</option> 
                            <option value="FIGHTER">제이</option> 
                            <option value="LANCER">미스틸테인</option> 
                            <? 검은양 캐릭터 ?>
                            <option value="HUNTER">나타</option> 
                            <option value="WITCH">레비아</option> 
                            <option value="ROGUE">하피</option> 
                            <option value="ARMS">티나</option> 
                            <option value="VALKYRIE">바이올렛</option> 
                            <? 늑대개 캐릭터 ?>
                            <option value="LIBRARIAN">볼프강 슈나이더</option> 
                            <option value="AEGIS">루나 아이기스</option> 
                            <option value="ASTRA">소마</option> 
                            <option value="MYSTIC">파이 윈체스터</option> 
                            <option value="BEAST">세트 세크메트</option> 
                            <? 사냥터지기 캐릭터 ?>
                            <option value="NONAME">김철수</option> 
                            <option value="REAPER">미래</option> 
                            <? 시궁쥐 캐릭터 ?>
                            <option value="ARMBAND">일러스트 완장</option>
                            <? 기타 ?></select> -->
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong> Costume </strong>
                        </td>
                        <td class="character_Area_Detail">
                            <select name="costume" id="costume" onchange="select_costume(this.options[this.selectedIndex].value);">
                                <option> </option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong> Frame Skin </strong> 
                        </td>
                        <td class="character_Area_Detail">
                            <select name="frameSkin" id="frameSkin" onchange="select_frame(this.options[this.selectedIndex].value);"></select>
                        </td>
                    </tr>
                </table>
            </div> 

            <div class="loading_Area">
                <dl class="loading_State">
                 <label>
                     <strong>Loading State</strong>
                     <input type="checkbox" id="loading_Active" name="loading_Active" class="loading_Active" onclick="slide_Disable(), updateCanvas();"/>
                 </label>
             </dl>

             <dl class="loading_Slider">
                <input type="range" name="range" min="0" max="100" value="0" class="slider" id="characterLOADING" style="display:none"> 
            </dl>

        </div>
        <div class="closer_Area">
            <dl class = "closer_Info">
              <input type="input" class="closer_field" id="characterID" placeholder=" " onkeydown="inputText(event.keyCode);" onkeyup="inputBackSpace(event.keyCode);"required/>
              <label for="characterID" class="closer_label">CLOSER NAME</label>
          </dl>

          <dl class = "closer_Info">
              <input type="input" class="closer_field" id="characterLEVEL" placeholder=" " onkeydown="inputText(event.keyCode);" onkeyup="inputBackSpace(event.keyCode);"required/>
              <label for="characterLEVEL" class="closer_label">CLOSER LEVEL</label>
          </dl>

          <dl class = "closer_Info">
              <input type="input" class="closer_field" id="characterTYPE" placeholder=" " onkeydown="inputText(event.keyCode);" onkeyup="inputBackSpace(event.keyCode);"required/>
              <label for="characterTYPE" class="closer_label">CLOSER RANK</label>
          </dl>
      </div>

      <div class="DL_button">
        <a class="download_button" download="closers.png" href="" onclick="download_img(this, event);">Download</a> </div>
    </div>

    <div class="null_Area">

    </div>
</div>
</div>

<!-- 패치정보 시작 -->
<div class="patch_Info">
    <dl class="text_Area">
<!--
        <span><h3> 현재 적용된 내용 </h3></span>
        <ul> - 일러스트, 프레임 선택 </ul>
        <ul> - 닉네임, 레벨 ,직급 입력 </ul>
        <ul> - 다운로드 버튼 </ul>

        <br>
        <span><h3> 앞으로 적용할 내용 </h3></span>
        <ul> - 검색 기능 </ul>
        <ul> - 페이지 스타일링 </ul>
        <ul> - 프레임 스킨 부가기능(샤이닝 효과, 비활성화 버튼) </ul>
        <br>
        <span><h3> 발견된 오류 </h3></span>
        <ul> - 한글 입력 시 표시가 늦음.<br>(영문 또는 숫자를 입력하면 고쳐짐)</ul>
    -->
    <span><h2> 안내 </h2></span>
    <ul>1. 본 클로저스 로딩 일러 생성기는 무료로 사용하실 수 있습니다.</ul>
    <ul>2. 본 생성기의 제작 및 배포에 있어 상업적인 목적이 없음을 안내드립니다 </ul>
    <ul>3. 본 생성기의 사용에 있어 상업적인 목적으로 사용할 수 없습니다.</ul>
    <ul>4. 해당 생성기를 이용한 악의적인 변조 및 배포는 자제 부탁드립니다. </ul>
    <ul>5. 일러 생성기 사용에 대해 의견 또는 문의사항이 있으신 경우, <strong>zuiriya@gmail.com</strong>으로 문의 주시기 바랍니다.</ul>
</dl>
</div>
<!-- 패치정보 끝 -->

</body>

<script type="text/javascript">
 if(window.addEventListener){
    window.addEventListener('load', Init, false);
}

var canvas, ctx
var characterID, characterLEVEL, characterTYPE, characterLOADING
var isFill = true;

function Init() {
  canvas = document.getElementById('canvas');
  ctx = canvas.getContext("2d");

  characterID = document.getElementById('characterID');
  characterLEVEL = document.getElementById('characterLEVEL');
  characterTYPE = document.getElementById('characterTYPE');
  characterLOADING = document.getElementById('characterLOADING');
//characterID.focus();
//characterLEVEL.focus();
//characterTYPE.focus();
}

function inputText(keyCode){   
  var textWidth = ctx.measureText(characterID.value).width;     
  updateCanvas(String.fromCharCode(keyCode), textWidth);     
}    

function inputBackSpace(keyCode){
  if(keyCode == 8 || keyCode == 46){
    clearCanvas();
    updateCanvas(characterID.value,0);
}      
}
function categoryChange(e) {

    var ARMBAND = ["큐티 하르파스", "섹시 틴달로스", "러블리 요드 [A]", "러블리 요드 [B]", "뷰티 니토크리스", "플라잉 바이테스", "프리티 벨제부브"]


    var costume_id = {
        "샤이닝☆스타": "_U1",
        "암흑의 광휘": "_R1",
        "사이버네틱": "_R2",
        "지고의 날개": "_R3",
        "칠흑의 날개": "_R4",
        "드래고니안": "_R5",
        "드래고니안 각성": "_R6",
        "기본 일러스트": "_N1",
        "정식": "_N2",
        "해결사": "_N2",
        "특수": "_N3",
        "태스크포스": "_N4",
        "4월의 고양이": "_APRIL",
        "로열 로즈": "_ROYAL",
        "나이트메어": "_NIGHT",
        "빅토리아 리퍼": "_VICTORIA",
        "꿈꾸는 소녀": "_ANNA",
        "이브닝 파티": "_EVENING_PARTY",
        "슈레딩거의 고양이": "_ESCAT",
        "스톰 라이더": "_STORMRIDER",
        "그레이스풀 레이디": "_GRACEFUL_LADY",
        "아르카나 조커": "_ARCANA_JOKER",
        "프로메테우스": "_PROMETHEUS",
        "선샤인 웨이브": "_SUNSHINE",
        "봄요정의 나들이": "_SPRING_FAIRY",
        "론 레인저": "_LONE_RANGER",
        "강철의 기동함장": "_STEEL_CAPTAIN",
        "템테이션 산타": "_2018_SANTA",
        "디멘션 노커": "_GIS",
        "설원의 프린세스": "_SNOWQUEEN",
        "하프 앤 하프": "_HNH",
        "하우스 키퍼": "_HOUSE_KEEPER",
        "유니온 시크릿 서비스": "_SECRET_SERVICE",
        "윈드브레이커": "_WINDBREAKER",
        "나른한 오전의 와이셔츠": "_SLEEPY",
        "그라운드 디비전": "_GROUND_DIVISION",
        "미드나잇 크루세이더": "_MIDNIGHT_CRUSADER",
        "서머 아일랜드": "_SUMMER_ISLAND",
        "롤리팝 트위스트": "_LOLLIPOP",
        "임페리얼 가드": "_IMPERIAL",
        "서빙 마스터": "_SERVING_MASTER",
        "신서울 요호": "_NINE_TAILS",
        "어반 싸울아비": "_URBAN_SSAUL",
        "포근한 겨울": "_WARM_WINTER",
        "체크 플래그": "_CHECK_FLAG",
        "은반의 앙상블": "_KISSANDCRY",
        "만우절": "_TS",
        "큐티 하르파스": "_HALPAS",
        "섹시 틴달로스": "_TINDALOS",
        "러블리 요드": "_YOD",
        "뷰티 니토크리스": "_CLONE",
        "플라잉 바이테스": "_BYTESS",
        "프리티 벨제부브": "_BAAL",
        "여름 바캉스": "_S",
        "해변의 랩소디": "_S2",
        "선샤인 스페셜": "_SUNSHINES",
        "원더랜드": "_WONDERLAND"
    };


    var target = document.getElementById("costume");
    var selected_class
    // from ./javascript/character_costumes.js
    switch (e.value) {
        case "STRIKER":
        selected_class = STRIKER;
        break;
        case "CASTER":
        selected_class = CASTER;
        break;
        case "RANGER":
        selected_class = RANGER;
        break;
        case "FIGHTER":
        selected_class = FIGHTER;
        break;
        case "LANCER":
        selected_class = LANCER;
        break;
        case "HUNTER":
        selected_class = HUNTER;
        break;
        case "WITCH":
        selected_class = WITCH;
        break;
        case "ROGUE":
        selected_class = ROGUE;
        break;
        case "ARMS":
        selected_class = ARMS;
        break;
        case "VALKYRIE":
        selected_class = VALKYRIE;
        break;
        case "LIBRARIAN":
        selected_class = LIBRARIAN;
        break;
        case "AEGIS":
        selected_class = AEGIS;
        break;
        case "ASTRA":
        selected_class = ASTRA;
        break;
        case "MYSTIC":
        selected_class = MYSTIC;
        break;
        case "BEAST":
        selected_class = BEAST;
        break;
        case "NONAME":
        selected_class = NONAME;
        break;
        case "REAPER":
        selected_class = REAPER;
        break;
        case "ARMBAND":
        selected_class = ARMBAND;
        break;
    }
    target.options.length = 0;

    for (index in selected_class) {
        var opt = document.createElement("option");
        var value = e.value + costume_id[selected_class[index].split(" [")[0]];
        switch (selected_class[index].substring(selected_class[index].indexOf('[') + 1, selected_class[index].indexOf(']'))) {
            case "A":
            value += "_A";
            break;
            case "B":
            value += "_B";
            break;
            case "C":
            value += "_C";
            break;
            case "D":
            value += "_D";
            break;
            case "혼합형":
            value += "_MIX";
            break;
            case "TYPE 2":
            value += "_2";
            break;
        }
        opt.value = value;
        opt.innerHTML = selected_class[index];
        target.appendChild(opt);
    }
}

var frameSkin = document.getElementById('frameSkin');
// from ./javascript/frame_options.js
for(var frame_i = 0, frame_l = frame_Options.length; frame_i < frame_l; frame_i++){
  var frame_option = frame_Options[frame_i];
  frameSkin.options.add( new Option(frame_option.frame_Text, frame_option.frame_Value, frame_option.selected) );
}

var img = new Image();
var img_BG = new Image();
var img_Frame = new Image();
var img_Trans = new Image();
var Trans_X = "1";
img_BG.src = "image/COMMON/BG.png";

img_BG.onload = function() {
  clearCanvas();
  drawImage();
  drawText();
}
img_Trans.onload = function() {
  clearCanvas();
  drawImage();
  drawText();
}

function drawImage() {
    ctx.drawImage(img_BG,0,0)
    ctx.drawImage(img,0,0)
    if(Trans_X>0) {
      ctx.drawImage(img_Trans, Trans_X, 0)
  }
  else {
    ctx.drawImage(img_Trans, 0, 0)
}
ctx.drawImage(img_Frame,0,0)
}

function select_frame(frame_Value) {
  img_Frame.src = "image/FRAME/" + frame_Value + ".png"
  img_Frame.onload = function() {
      clearCanvas();
      drawImage();
      drawText();
  }
}

function select_costume(character_class){
    var strArray = character_class.split('_')
    img.src = "image/" + strArray[0] + "/" + character_class + ".png"
    img.onload = function() {
        clearCanvas();
        drawImage();
        drawText();
    }
}

function drawText() {    
    ctx.font="18px NanumBarunGothic";
    ctx.lineWidth = 1;
    ctx.fillStyle = "white";
    ctx.textAlign = "right";
    ctx.shadowBlur = 10;
    ctx.shadowColor = "black";
    ctx.fillStyle = "rgb(255,255,255)";

    ctx.strokeText(document.getElementById("characterID").value, canvas.width-9, 24);
    ctx.fillText(document.getElementById("characterID").value, canvas.width-9, 24);

    ctx.strokeText(document.getElementById("characterTYPE").value, canvas.width-9, 85);
    ctx.fillText(document.getElementById("characterTYPE").value, canvas.width-9, 85);

    ctx.fillStyle = "rgb(255,220,0)";

    var check=document.getElementById("characterLEVEL").value
    if(check > 0) {
        ctx.strokeText("LV " + document.getElementById("characterLEVEL").value, canvas.width-10, 56);

        ctx.fillText("LV " + document.getElementById("characterLEVEL").value, canvas.width-10, 56);
    }
    if(loading_Active.checked) {
        ctx.font="23px NanumBarunGothic";
        ctx.strokeText(characterLOADING.value + " %",canvas.width-12, 153);
        ctx.fillText(characterLOADING.value + " %",canvas.width-12, 153);
    }
    else
    {
        ctx.strokeText(" ",canvas.width-12, 153);
        ctx.fillText(" ",canvas.width-12, 153);
    }
}

function drawText_realtime() {
    characterID.oninput = function() {
        ctx.fillStyle = "rgb(255,255,255)";
        ctx.strokeText(document.getElementById("characterID").value, canvas.width-9, 24);
        ctx.fillText(document.getElementById("characterID").value, canvas.width-9, 24);
        clearCanvas();
        drawImage();
        drawText();};

        characterTYPE.oninput = function() {
            ctx.fillStyle = "rgb(255,255,255)";
            ctx.strokeText(document.getElementById("characterTYPE").value, canvas.width-9, 85);
            ctx.fillText(document.getElementById("characterTYPE").value, canvas.width-9, 85);
            clearCanvas();
            drawImage();
            drawText();};

            characterLEVEL.oninput = function() {
                ctx.strokeText(document.getElementById("characterLEVEL").value, canvas.width-10, 56);
                ctx.fillStyle = "rgb(255,220,0)";
                ctx.fillText(document.getElementById("characterLEVEL").value, canvas.width-10, 56);
                clearCanvas();
                drawImage();
                drawText();};

                characterLOADING.oninput = function() {
                    Trans_X = this.value*"5.12";
                    if(loading_Active.checked) {
                        ctx.font="23px NanumBarunGothic";
                        ctx.strokeText(characterLOADING.value + " %",canvas.width-12, 153);
                        ctx.fillText(characterLOADING.value + " %",canvas.width-12, 153);
                        clearCanvas();
                        drawImage();
                        drawText();
                    }
                    else
                    {
                        ctx.strokeText(" ",canvas.width-12, 153);
                        ctx.fillText(" ",canvas.width-12, 153);
                    }
                }
            }

            function updateCanvas() {
                drawText_realtime();
                clearCanvas();
                drawImage();
                drawText();
            }
            function clearCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawImage();
            }

            function download_img(el, event) {
    // for IE
    if (canvas.msToBlob) {
        // 파일창 켜짐 방지
        event.preventDefault()
        let imageBlob = canvas.msToBlob()
        let downloadName = 'closers.png'
        window.navigator.msSaveBlob(imageBlob, downloadName)
    } else {
        let imageURI = canvas.toDataURL("image/png");
        el.href = imageURI;
    }
}
function slide_Disable() {
    Trans_X = this.value*"5.12";

    if(loading_Active.checked) {            
        characterLOADING.style.display="block";
        img_Trans.src = "image/COMMON/TRANSPARENCY.png";
        updateCanvas();
    }
    else
    {
        characterLOADING.style.display="none";
        img_Trans.src = "image/COMMON/NULL.png";
    }
}

</script>

</html>
